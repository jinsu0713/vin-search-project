<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIN ê²€ìƒ‰ ê°¤ëŸ¬ë¦¬</title>
    <style>
        /* ê¸°ë³¸ì ì¸ UI ìŠ¤íƒ€ì¼ */
        body { 
            font-family: Arial, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding-top: 50px; 
            background-color: #f8f9fa;
        }
        h1 { color: #343a40; }
        .search-box { 
            background-color: #ffffff; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
            text-align: center;
            margin-top: 20px;
        }
        h2 { margin-top: 0; color: #495057; }
        input[type="text"] { 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 6px; 
            width: 300px; 
            margin-right: 10px; 
            font-size: 16px;
        }
        button { 
            padding: 12px 25px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        #result-area { 
            margin-top: 40px; 
            font-size: 1.1em; 
            text-align: center;
        }
        .error { 
            color: #dc3545; 
            font-weight: bold;
        }
        .success-message { 
            color: #28a745; 
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>My Car Photo at Incheon port, Korea ğŸš¢ğŸš—ğŸ‡°ğŸ‡·</h1>
    <p>Enter the last 8 or full 17 digits of the VIN.</p>

    <div class="search-box">
        <h2>What is the VIN of your car?</h2>
        <input type="text" id="vinInput" placeholder="Last 8 or Full 17 VIN digits" maxlength="17">
        <button onclick="searchVin()">Search</button>
    </div>

    <div id="result-area"></div>

    <!-- 1. Firebase SDK ì¶”ê°€ (v9 í˜¸í™˜ ë²„ì „) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <script>
        // â­ Firebase í”„ë¡œì íŠ¸ ì„¤ì • ì •ë³´ (ê³ ê°ë‹˜ì˜ photo2-352bf í”„ë¡œì íŠ¸ ì •ë³´) â­
        const firebaseConfig = {
            apiKey: "AIzaSyDvlHZf1CYmpwuLBfHUC9A1KAj608ekX6Q",
            authDomain: "photo2-352bf.firebaseapp.com",
            projectId: "photo2", 
            storageBucket: "photo2-352bf.firebasestorage.app",
            messagingSenderId: "603476388610",
            appId: "1:603476388610:web:67117489236ff3900c701b",
            measurementId: "G-Z69XFJQJ7D"
        };

        // Firebase ì´ˆê¸°í™” ë¡œì§
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            console.log("Firebase initialized successfully.");

        } catch (e) {
            console.error("Firebase Initialization Error:", e);
            document.getElementById('result-area').innerHTML = 
                '<p class="error">âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨! (API í‚¤ ë˜ëŠ” í”„ë¡œì íŠ¸ ID ì˜¤ë¥˜)</p>';
            
        }
        
        // ğŸŒŸğŸŒŸğŸŒŸ ì»¬ë ‰ì…˜ ì´ë¦„ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ 'casrs'ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤. ğŸŒŸğŸŒŸğŸŒŸ
        const carsRef = db ? db.collection("casrs") : null; 

        /**
         * VINì„ ê²€ìƒ‰í•˜ê³  Firestoreì—ì„œ ì•¨ë²” URLì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
         */
        async function searchVin() {
            const vin = document.getElementById('vinInput').value.trim();
            const resultArea = document.getElementById('result-area');
            
            if (!db) {
                resultArea.innerHTML = '<p class="error">Firebase ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½˜ì†” ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
                return;
            }

            resultArea.innerHTML = '<p style="color: #007bff;">ğŸ” Searching...</p>';

            if (!vin) {
                resultArea.innerHTML = '<p class="error">VIN ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
                return;
            }

            try {
                // Firestoreì—ì„œ VIN(Document ID)ìœ¼ë¡œ ì§ì ‘ ì¡°íšŒ
                const doc = await carsRef.doc(vin).get();

                if (doc.exists) {
                    // í•„ë“œ ì´ë¦„ë„ 'albumUrl'ë¡œ ì •í™•íˆ ì§€ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
                    const url = doc.data().albumUrl; 
                    
                    if (url) {
                         resultArea.innerHTML = `
                            <p class="success-message">âœ… VIN **${vin}** ì— ëŒ€í•œ ì•¨ë²”ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!</p>
                            <p>
                                <a href="${url}" target="_blank" style="color: #007bff; font-weight: bold; text-decoration: none;">â¡ï¸ Google í¬í†  ì•¨ë²” ë°”ë¡œê°€ê¸°</a>
                            </p>
                        `;
                    } else {
                         resultArea.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ì•¨ë²” URL ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. Firestore í•„ë“œ(albumUrl)ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
                    }
                   
                } else {
                    resultArea.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: VIN **${vin}** ì— í•´ë‹¹í•˜ëŠ” ì°¨ëŸ‰ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }
            } catch (error) {
                console.error("Firestore Read Error (Check Rules/Data):", error); 
                resultArea.innerHTML = `<p class="error">ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (Consoleì„ í™•ì¸í•˜ì„¸ìš”)</p>`;
            }
        }
    </script>
</body>
</html>